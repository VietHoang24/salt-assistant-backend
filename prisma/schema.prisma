// -----------------------------
// Generators & Datasource
// -----------------------------
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// -------------------------------------------------------------
// USERS & CONFIG
// -------------------------------------------------------------
model users {
  id               String   @id @default(uuid())
  email            String?  @unique
  google_id        String?  @unique
  full_name        String?
  avatar_url       String?
  telegram_chat_id String?
  timezone         String?
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  user_configs       user_configs?
  user_categories    user_categories[]
  user_goals         user_goals[]
  user_goal_logs     user_goal_logs[]
  user_daily_summary user_daily_summary[]
  notification_logs  notification_logs[]
}

// -------------------------
model user_configs {
  id            String    @id @default(uuid())
  user_id       String    @unique
  morning_time  DateTime? @db.Time
  evening_time  DateTime? @db.Time
  funfact_time  DateTime? @db.Time
  summary_style String?
  enable_notif  Boolean?
  created_at    DateTime  @db.Timestamptz
  updated_at    DateTime  @db.Timestamptz

  user users @relation(fields: [user_id], references: [id])
}

// -------------------------------------------------------------
// CATEGORIES & USER INTERESTS
// -------------------------------------------------------------
model categories {
  id         String   @id @default(uuid())
  name       String
  slug       String   @unique
  is_default Boolean
  created_at DateTime @db.Timestamptz

  user_categories user_categories[]
  news            news[]
}

model user_categories {
  id          String   @id @default(uuid())
  user_id     String
  category_id String
  created_at  DateTime @db.Timestamptz

  user     users      @relation(fields: [user_id], references: [id])
  category categories @relation(fields: [category_id], references: [id])
}

// -------------------------------------------------------------
// GOALS
// -------------------------------------------------------------
enum GoalType {
  yearly
  monthly
  weekly
}

model user_goals {
  id          String   @id @default(uuid())
  user_id     String
  title       String
  description String?
  type        GoalType

  created_at DateTime @db.Timestamptz
  updated_at DateTime @db.Timestamptz

  start_date DateTime @db.Timestamptz
  end_date   DateTime @db.Timestamptz

  user users            @relation(fields: [user_id], references: [id])
  logs user_goal_logs[]
}

model user_goal_logs {
  id          String   @id @default(uuid())
  user_id     String
  goal_id     String
  progress    Decimal? @db.Decimal
  log_message String?
  created_at  DateTime @db.Timestamptz

  user users      @relation(fields: [user_id], references: [id])
  goal user_goals @relation(fields: [goal_id], references: [id])
}

// -------------------------------------------------------------
// NEWS & MARKET
// -------------------------------------------------------------
model news {
  id           String    @id @default(uuid())
  source       String
  title        String
  content      String?
  url          String?
  category_id  String?
  published_at DateTime? @db.Timestamptz
  created_at   DateTime  @db.Timestamptz

  category categories? @relation(fields: [category_id], references: [id])
}

model market_data {
  id           String   @id @default(uuid())
  gold_price   Decimal? @db.Decimal
  btc_price    Decimal? @db.Decimal
  eth_price    Decimal? @db.Decimal
  usd_vnd_rate Decimal? @db.Decimal
  created_at   DateTime @db.Timestamptz
}

// -------------------------------------------------------------
// AI SUMMARY
// -------------------------------------------------------------
model ai_daily_summary {
  id            String   @id @default(uuid())
  date          DateTime @unique @db.Date
  summary_text  String?
  macro_events  Json?
  risks         Json?
  opportunities Json?
  created_at    DateTime @db.Timestamptz
}

model user_daily_summary {
  id             String    @id @default(uuid())
  user_id        String
  date           DateTime  @db.Date
  summary_text   String?
  raw_ai_summary String?
  user_custom    Json?
  sent_at        DateTime? @db.Timestamptz
  created_at     DateTime  @db.Timestamptz

  user users @relation(fields: [user_id], references: [id])
}

// -------------------------------------------------------------
// SYSTEM LOGGING
// -------------------------------------------------------------
model notification_logs {
  id         String    @id @default(uuid())
  user_id    String
  channel    String
  type       String
  content    String?
  status     String
  sent_at    DateTime? @db.Timestamptz
  created_at DateTime? @default(now()) @db.Timestamptz

  user users @relation(fields: [user_id], references: [id])
}

model error_logs {
  id            String   @id @default(uuid())
  service       String
  error_message String
  data_snapshot Json?
  created_at    DateTime @db.Timestamptz
}
